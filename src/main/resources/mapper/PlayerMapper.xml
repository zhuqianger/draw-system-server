<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.drawsystemserver.mapper.PlayerMapper">

    <resultMap id="BaseResultMap" type="org.example.drawsystemserver.entity.Player">
        <id column="id" property="id"/>
        <result column="sessionId" property="sessionId"/>
        <result column="groupId" property="groupId"/>
        <result column="groupName" property="groupName"/>
        <result column="gameId" property="gameId"/>
        <result column="position" property="position"/>
        <result column="heroes" property="heroes"/>
        <result column="rank" property="rank"/>
        <result column="cost" property="cost"/>
        <result column="status" property="status"/>
        <result column="currentAuctionId" property="currentAuctionId"/>
        <result column="teamId" property="teamId"/>
        <result column="createTime" property="createTime"/>
        <result column="updateTime" property="updateTime"/>
    </resultMap>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM player WHERE id = #{id}
    </select>

    <select id="selectByStatus" resultMap="BaseResultMap">
        SELECT * FROM player WHERE status = #{status} ORDER BY id
    </select>

    <select id="selectBySessionId" resultMap="BaseResultMap">
        SELECT * FROM player WHERE sessionId = #{sessionId} ORDER BY groupId
    </select>

    <select id="selectBySessionIdAndStatus" resultMap="BaseResultMap">
        SELECT * FROM player WHERE sessionId = #{sessionId} AND status = #{status} ORDER BY groupId
    </select>

    <select id="selectByTeamId" resultMap="BaseResultMap">
        SELECT * FROM player WHERE teamId = #{teamId} ORDER BY id
    </select>

    <select id="selectByTeamIdExcludingCaptain" resultMap="BaseResultMap">
        SELECT * FROM player WHERE teamId = #{teamId} AND id != #{captainId} ORDER BY id
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT * FROM player ORDER BY id
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO player (sessionId, groupId, groupName, gameId, position, heroes, `rank`, cost, status)
        VALUES (#{sessionId}, #{groupId}, #{groupName}, #{gameId}, #{position}, #{heroes}, #{rank}, #{cost}, #{status})
    </insert>

    <update id="update">
        UPDATE player
        <set>
            <if test="groupId != null">groupId = #{groupId},</if>
            <if test="groupName != null">groupName = #{groupName},</if>
            <if test="gameId != null">gameId = #{gameId},</if>
            <if test="position != null">position = #{position},</if>
            <if test="heroes != null">heroes = #{heroes},</if>
            <if test="rank != null">`rank` = #{rank},</if>
            <if test="cost != null">cost = #{cost},</if>
            <if test="status != null">status = #{status},</if>
            <if test="currentAuctionId != null">currentAuctionId = #{currentAuctionId},</if>
            <if test="teamId != null">teamId = #{teamId},</if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE player SET status = #{status} WHERE id = #{id}
    </update>

    <update id="updateCurrentAuctionId">
        UPDATE player SET currentAuctionId = #{auctionId} WHERE id = #{id}
    </update>

    <update id="updateTeamId">
        UPDATE player SET teamId = #{teamId} WHERE id = #{id}
    </update>

    <delete id="deleteBySessionId">
        DELETE FROM player WHERE sessionId = #{sessionId}
    </delete>

</mapper>
