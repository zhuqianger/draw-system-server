<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.drawsystemserver.mapper.TeamMapper">

    <resultMap id="BaseResultMap" type="org.example.drawsystemserver.entity.Team">
        <id column="id" property="id"/>
        <result column="sessionId" property="sessionId"/>
        <result column="captainId" property="captainId"/>
        <result column="userId" property="userId"/>
        <result column="teamName" property="teamName"/>
        <result column="captainName" property="captainName"/>
        <result column="playerCount" property="playerCount"/>
        <result column="totalCost" property="totalCost"/>
        <result column="nowCost" property="nowCost"/>
        <result column="createTime" property="createTime"/>
        <result column="updateTime" property="updateTime"/>
    </resultMap>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM team WHERE id = #{id}
    </select>

    <select id="selectByIdForUpdate" resultMap="BaseResultMap">
        SELECT * FROM team WHERE id = #{id} FOR UPDATE
    </select>

    <select id="selectByCaptainId" resultMap="BaseResultMap">
        SELECT * FROM team WHERE captainId = #{captainId} LIMIT 1
    </select>

    <select id="selectByUserId" resultMap="BaseResultMap">
        SELECT * FROM team WHERE userId = #{userId} LIMIT 1
    </select>

    <select id="selectBySessionId" resultMap="BaseResultMap">
        SELECT * FROM team WHERE sessionId = #{sessionId} ORDER BY id
    </select>

    <select id="selectBySessionIdAndCaptainId" resultMap="BaseResultMap">
        SELECT * FROM team WHERE sessionId = #{sessionId} AND captainId = #{captainId} LIMIT 1
    </select>

    <select id="selectBySessionIdAndUserId" resultMap="BaseResultMap">
        SELECT * FROM team WHERE sessionId = #{sessionId} AND userId = #{userId} LIMIT 1
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT * FROM team ORDER BY id
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO team (sessionId, captainId, userId, teamName, captainName, playerCount, totalCost, nowCost)
        VALUES (#{sessionId}, #{captainId}, #{userId}, #{teamName}, #{captainName}, #{playerCount}, #{totalCost}, #{nowCost})
    </insert>

    <update id="update">
        UPDATE team
        <set>
            <if test="sessionId != null">sessionId = #{sessionId},</if>
            <if test="captainId != null">captainId = #{captainId},</if>
            <if test="userId != null">userId = #{userId},</if>
            <if test="teamName != null">teamName = #{teamName},</if>
            <if test="captainName != null">captainName = #{captainName},</if>
            <if test="playerCount != null">playerCount = #{playerCount},</if>
            <if test="totalCost != null">totalCost = #{totalCost},</if>
            <if test="nowCost != null">nowCost = #{nowCost},</if>
        </set>
        WHERE id = #{id}
    </update>

    <update id="incrementPlayerCount">
        UPDATE team SET playerCount = playerCount + 1 WHERE id = #{id}
    </update>

    <update id="decrementPlayerCount">
        UPDATE team SET playerCount = playerCount - 1 WHERE id = #{id} AND playerCount > 0
    </update>

    <update id="decreaseNowCost">
        UPDATE team SET nowCost = nowCost - #{amount} WHERE id = #{id} AND nowCost IS NOT NULL AND nowCost >= #{amount}
    </update>

    <delete id="deleteBySessionId">
        DELETE FROM team WHERE sessionId = #{sessionId}
    </delete>

</mapper>
